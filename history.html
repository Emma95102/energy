    <script src="main.js"></script>
    <script src="history.js"></script>

    <!-- Firebase：歷史紀錄頁，從 Firestore 讀取 testDailyRecords -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
      import {
        getFirestore,
        collection,
        getDocs
      } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyC1j-dogTtBDR3pt5KehghpJFbRbLcIpM",
        authDomain: "energy-e1c4b.firebaseapp.com",
        projectId: "energy-e1c4b",
        storageBucket: "energy-e1c4b.firebasestorage.app",
        messagingSenderId: "349372717450",
        appId: "1:349372717450:web:1b1ebc5b0066a4acc89073"
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      console.log("Firebase: history.html 初始化完成");

      const historyList = document.getElementById("history-list");
      const prevBtn = document.getElementById("prev-page");
      const nextBtn = document.getElementById("next-page");
      const pageInfo = document.getElementById("page-info");

      if (prevBtn) prevBtn.disabled = true;
      if (nextBtn) nextBtn.disabled = true;
      if (pageInfo) pageInfo.textContent = "由 Firebase 載入";

      async function loadHistoryFromFirebase() {
        try {
          const snap = await getDocs(collection(db, "testDailyRecords"));

          if (snap.empty) {
            historyList.innerHTML = "<p>目前 Firebase 中沒有任何歷史紀錄。</p>";
            alert("Firebase 中尚無歷史資料");
            return;
          }

          const items = [];
          snap.forEach(docSnap => {
            const data = docSnap.data();
            items.push({
              id: docSnap.id,
              date: data.date || docSnap.id,
              points: data.points || 0,
              note: data.note || "（無）",
              createdAt: data.createdAt || null
            });
          });

          items.sort((a, b) => b.date.localeCompare(a.date));

          let html = "";
          for (const item of items) {
            const timeText = item.createdAt?.toDate
              ? item.createdAt.toDate().toLocaleString("zh-TW")
              : "時間未記錄";

            html += `
              <div class="history-item">
                <h3>${item.date} — ${item.points} 點</h3>
                <p><strong>備註：</strong>${item.note}</p>
                <p class="small muted">寫入時間：${timeText}</p>
                <hr>
              </div>
            `;
          }

          historyList.innerHTML = html;
          if (pageInfo) pageInfo.textContent = `共 ${items.length} 筆紀錄`;
          alert("✅ 已成功從 Firebase 載入歷史紀錄！");

        } catch (err) {
          console.error("讀取 Firebase 失敗：", err);
          alert("讀取 Firebase 失敗，請查看 Console");
        }
      }

      loadHistoryFromFirebase();
    </script>
  </body>
</html>
