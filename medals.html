<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>çç‰Œç´€éŒ„ - ç¯€èƒ½ç¿’æ…£è¿½è¹¤å™¨</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>ç¯€èƒ½ç¿’æ…£è¿½è¹¤å™¨</h1>
    <p class="subtitle">å°ç¿’æ…£å¸¶ä¾†å¤§å½±éŸ¿ â€” SDGs 7 / 11 / 13</p>
    <nav>
      <a href="home.html"><button>ğŸ  é¦–é </button></a>
      <a href="behavior.html"><button>ğŸ“‹ è¡Œç‚ºè¡¨</button></a>
      <a href="history.html"><button>ğŸ“˜ æ­·å²ç´€éŒ„</button></a>
      <a href="medals.html"><button>ğŸ… çç‰Œç´€éŒ„</button></a>
    </nav>
  </header>

  <main class="page">
    <section class="card">
      <h2>çç‰Œç´€éŒ„</h2>
      <div id="medal-list"></div>
    </section>
  </main>

    <script src="main.js"></script>
    <script src="medals.js"></script>

  <!-- Firebaseï¼šçç‰Œé å°ˆç”¨ï¼ˆè®€å– / å¯«å…¥æ¸¬è©¦ç”¨çç‰Œï¼‰ -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      getDocs,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    // âœ… å’Œå…¶ä»–é é¢ä¸€æ¨£çš„ configï¼ˆè¨˜å¾—ç”¨é€™çµ„ï¼‰
    const firebaseConfig = {
      apiKey: "AIzaSyC1j-dogTtBDR3pt5KehghpJFbRbLcIpM",
      authDomain: "energy-e1c4b.firebaseapp.com",
      projectId: "energy-e1c4b",
      storageBucket: "energy-e1c4b.firebasestorage.app",
      messagingSenderId: "349372717450",
      appId: "1:349372717450:web:1b1ebc5b0066a4acc89073"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    console.log("Firebase: medals.html åˆå§‹åŒ–å®Œæˆ");

    const medalList = document.getElementById("medal-list");
    const cardSection = document.querySelector(".card");

    // å»ºä¸€å€‹ã€Œæ–°å¢æ¸¬è©¦çç‰Œã€æŒ‰éˆ•ï¼ˆåªç‚ºäº†æ¸¬è©¦å¯«å…¥ï¼‰
    const testBtn = document.createElement("button");
    testBtn.textContent = "æ–°å¢ä¸€é¢æ¸¬è©¦çç‰Œï¼ˆå¯«å…¥ Firebaseï¼‰";
    testBtn.style.marginTop = "16px";
    cardSection.appendChild(testBtn);

    testBtn.addEventListener("click", async () => {
      try {
        await addDoc(collection(db, "testMedals"), {
          name: "æ¸¬è©¦çç‰Œ",
          reason: "æ‰‹å‹•æ–°å¢æ¸¬è©¦ç”¨",
          createdAt: serverTimestamp()
        });

        alert("âœ… å·²æˆåŠŸå¯«å…¥ä¸€é¢æ¸¬è©¦çç‰Œåˆ° Firebaseï¼");
        await loadMedals(); // å¯«å®Œé‡è¼‰åˆ—è¡¨
      } catch (err) {
        console.error("å¯«å…¥çç‰Œå¤±æ•—ï¼š", err);
        alert("å¯«å…¥ Firebase å¤±æ•—ï¼Œè«‹é–‹ F12 çœ‹éŒ¯èª¤è¨Šæ¯");
      }
    });

    // è®€å–æ‰€æœ‰çç‰Œç´€éŒ„
    async function loadMedals() {
      try {
        const snap = await getDocs(collection(db, "testMedals"));

        if (snap.empty) {
          medalList.innerHTML = "<p>ç›®å‰æ²’æœ‰ä»»ä½•çç‰Œç´€éŒ„ï¼ˆFirebaseï¼‰</p>";
          return;
        }

        let html = "";
        snap.forEach(docSnap => {
          const data = docSnap.data();
          const name = data.name || "æœªå‘½åçç‰Œ";
          const reason = data.reason || "ï¼ˆç„¡èªªæ˜ï¼‰";
          const time = data.createdAt
            ? data.createdAt.toDate().toLocaleString("zh-TW")
            : "æœªçŸ¥æ™‚é–“";

          html += `
            <div class="medal-item">
              <p>ğŸ… <strong>${name}</strong></p>
              <p>åŸå› ï¼š${reason}</p>
              <p class="small muted">ç²å¾—æ™‚é–“ï¼š${time}</p>
              <hr>
            </div>
          `;
        });

        medalList.innerHTML = html;
        console.log("âœ… å·²å¾ Firebase è¼‰å…¥çç‰Œç´€éŒ„");
      } catch (err) {
        console.error("è®€å–çç‰Œå¤±æ•—ï¼š", err);
        alert("è®€å– Firebase å¤±æ•—ï¼Œè«‹é–‹ F12 çœ‹éŒ¯èª¤è¨Šæ¯");
      }
    }

    // ä¸€é€²é é¢å°±å…ˆè¼‰å…¥ä¸€æ¬¡
    loadMedals();
  </script>
</body>
</html>



</body>
</html>
