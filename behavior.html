<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>è¡Œç‚ºè¡¨ - ç¯€èƒ½ç¿’æ…£è¿½è¹¤å™¨</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>ç¯€èƒ½ç¿’æ…£è¿½è¹¤å™¨</h1>
    <p class="subtitle">å°ç¿’æ…£å¸¶ä¾†å¤§å½±éŸ¿ â€” SDGs 7 / 11 / 13</p>
    <nav>
      <a href="home.html"><button>ğŸ  é¦–é </button></a>
      <a href="behavior.html"><button>ğŸ“‹ è¡Œç‚ºè¡¨</button></a>
      <a href="history.html"><button>ğŸ“˜ æ­·å²ç´€éŒ„</button></a>
      <a href="medals.html"><button>ğŸ… çç‰Œç´€éŒ„</button></a>
    </nav>

    <section class="card" id="fixed-animation">
      <h3>æœ¬é€±é€²åº¦èˆ‡èµ°è·¯å°å‹•ç•«</h3>
      <div id="track" class="track"><div id="walker" class="walker">ğŸš¶â€â™‚ï¸</div></div>
      <div class="row small">
        <div>ä»Šæ—¥å¾—åˆ†ï¼š<span id="today-points">0</span> é»</div>
        <div>é€²åº¦ï¼š<span id="week-points-2">0</span>/<span id="weekly-goal-2"></span></div>
      </div>
      <div id="medal-note" class="small muted"></div>
    </section>
  </header>

  <main id="page-home" class="page">
    <section class="card">
      <div class="row">
        <div><strong>æœ¬é€±ä¸Šé™ï¼š</strong><span id="weekly-goal-label"></span> é»</div>
        <div><strong>æœ¬é€±ç´¯ç©ï¼š</strong><span id="week-points">0</span> é»</div>
      </div>

      <h2>ä»Šå¤©çš„ç¯€èƒ½è¡Œç‚º</h2>
      <div id="task-list" class="task-list"></div>

      <label for="note">ä»Šæ—¥å‚™è¨»ï¼ˆé¸å¡«ï¼‰</label>
      <textarea id="note" placeholder="å¯«ä¸‹ä»Šå¤©çš„å°ç¿’æ…£æˆ–å¿ƒå¾—..."></textarea>

      <div class="controls"><button id="save-btn">å„²å­˜ä»Šå¤©çš„ç´€éŒ„</button></div>
    </section>
  </main>
  <audio id="save-sound" src="audio/high-tech-bleep.mp3" type="audio/mp3"></audio>
<!--  <audio id="save-sound" src="https://s17.aconvert.com/convert/p3r68-cdx67/nvn9w-7w6i8.mp3" preload="auto"></audio> -->

  <footer class="footer"><small>æ¯é€±å¾é€±ä¸€ 00:00 ç‚ºæ–°é€±ï¼›ä¸€é€±é”æ¨™å°‡è‡ªå‹•é ˜å–çç‰Œã€‚</small></footer>

  <script src="main.js"></script>
  <script src="behavior.js"></script>

   <!-- ğŸ”¥ åªåœ¨é€™å€‹é é¢æ¸¬è©¦å¯«å…¥ Firestore -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    // âœ… ç”¨ Firebase console ä¸Šé‚£ä¸€çµ„è¨­å®š
    const firebaseConfig = {
      apiKey: "AIzaSyC1j-dOgTlBdQR3Tpt5KehghPJfbRblcpM",
      authDomain: "energy-e1c4b.firebaseapp.com",
      projectId: "energy-e1c4b",
      storageBucket: "energy-e1c4b.firebasestorage.app",
      messagingSenderId: "349372717450",
      appId: "1:349372717450:web:1b1ebc5b0066a4acc89073"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    console.log("Firebase for behavior.html åˆå§‹åŒ–å®Œæˆ");

    const saveBtn = document.getElementById("save-btn");
    const noteEl = document.getElementById("note");
    const todayPointsEl = document.getElementById("today-points");

    if (saveBtn) {
      saveBtn.addEventListener("click", async () => {
        const today = new Date().toISOString().split("T")[0];
        const note = noteEl ? (noteEl.value || "") : "";
        const points = todayPointsEl ? Number(todayPointsEl.textContent || "0") : 0;

        try {
          // â¬‡â¬‡ æ¸¬è©¦ç”¨ï¼šå¯«åˆ° testDailyRecords é€™å€‹é›†åˆ
          await setDoc(
            doc(db, "testDailyRecords", today),
            {
              date: today,
              points: points,
              note: note,
              createdAt: serverTimestamp()
            },
            { merge: true }
          );

          alert("å·²å¯«å…¥ Firebaseï¼ï¼ˆé›†åˆï¼štestDailyRecordsï¼‰");
        } catch (err) {
          console.error("å¯«å…¥ Firebase å¤±æ•—ï¼š", err);
          alert("å¯«å…¥ Firebase å¤±æ•—ï¼Œè«‹æ‰“é–‹ F12 çš„ Console çœ‹éŒ¯èª¤è¨Šæ¯");
        }
      });
    } else {
      console.warn("æ‰¾ä¸åˆ° #save-btn æŒ‰éˆ•");
    }
  </script>
</body>
</html>
